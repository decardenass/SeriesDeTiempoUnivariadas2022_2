---
title: "prueba_proyecto"
output: html_document
date: "2022-10-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Cuaderno de prueba proyecto Series de tiempo univariadas

```{r}
library(readr)
```

Carga de datos desde repositorio
```{r}
# Datos acciones Bancolombia DIARIAS (01-01-2018 al 31-08-2022)
url_1 = 'https://raw.githubusercontent.com/decardenass/SeriesDeTiempoUnivariadas2022_2/main/Proyecto/Datos/Datos%20hist%C3%B3ricos%20BIC%20diaria_3.csv'

# Datos precipitación MENSUALES (01-2000 al 08-2022)
url_2 = 'https://raw.githubusercontent.com/decardenass/SeriesDeTiempoUnivariadas2022_2/main/Proyecto/Datos/Datos%20precipitaci%C3%B3n%20mensual.csv'

df_1 = read.csv(url_1, sep=";")
df_2 = read.csv(url_2, sep=";")
```

Ajuste de fecha
```{r}
df_1$Fecha = as.Date(df_1$Fecha)
df_2$Fecha = as.Date(df_2$Fecha)
```

## Serie de tiempo 1 ----- Acciones Bancolombia -----
```{r}
df_1.ts = ts(df_1$`Último`, frequency = 365, start=c(2018, 01, 02))
plot.ts(df_1.ts, main = "Precio al cierre de acciones Bancolombia diario", xlab = "Tiempo", ylab = "Precio")
```

Diagrama de autocorrelación acciones Bancolombia
```{r}
## ----- Diagrama de autocorrelación acciones Bancolombia ----- ###

acf(df_1['Último'], lag.max = NULL,
    type = "correlation",
    plot = TRUE,
    na.action = na.fail,
    main = "Autocorrelación acciones Bancolombia")
```

Diagrama de autocorrelación parcial acciones Bancolombia
```{r}
## ----- Diagrama de autocorrelación parcial acciones Bancolombia ----- ###

pacf(df_1['Último'], lag.max = NULL,
    plot = TRUE,
    na.action = na.fail,
    main = "Autocorrelación parcial acciones Bancolombia")
```

Regresión para determinar tendencia de acciones Bancolombia
```{r}
summary(fit_df_1 <- lm(df_1.ts~time(df_1.ts), na.action=NULL))
```

Gráfico con recta de tendencia acciones Bancolombia
```{r}
# Gráfico con recta de tendencia
plot(df_1.ts, ylab="Precio accion") 
abline(fit_df_1,col = "red") # Se añade la recta ajusta
```

Gráfico con tendencia eliminada de acciones Bancolombia
```{r}
###Eliminamos la tendencia con la predicción la recta
ElimiTenddf_1.ts=df_1.ts-predict(fit_df_1)
plot(ElimiTenddf_1.ts, ylab="Precio accion", main="Serie Bancolombia Sin tendencia")
```

Mapa de calor acciones Bancolombia
```{r}
TSstudio::ts_heatmap(ElimiTenddf_1.ts,title = "Mapa de Calor - acciones Bancolombia")
```

# _____
# Serie de tiempo 2 ----- Precipitaciones -----
```{r}
df_2.ts = ts(df_2$`Valor`, frequency = 12, start=c(2000, 1))
plot.ts(df_2.ts, main = "Precipitación mensual", xlab = "Tiempo", ylab = "Pm")
```


```{r}
## ----- Diagrama de autocorrelación precipitaciones ----- ###

acf(df_2['Valor'], lag.max = NULL,
    type = "correlation",
    plot = TRUE,
    na.action = na.fail,
    main = "Autocorrelación precipitaciones")
```


```{r}
## ----- Diagrama de autocorrelación parcial precipitaciones ----- ###

pacf(df_2['Valor'], lag.max = NULL,
    plot = TRUE,
    na.action = na.fail,
    main = "Autocorrelación parcial precipitaciones")
```


```{r}
summary(fit_df_2 <- lm(df_2.ts~time(df_2.ts), na.action=NULL))
```


```{r}
# Gráfico con recta de tendencia
plot(df_2.ts, ylab="Pm") 
abline(fit_df_2,col = "red") # Se añade la recta ajusta
```


```{r}
###Eliminamos la tendencia con la predicción la recta
ElimiTenddf_2.ts=df_2.ts-predict(fit_df_2)
plot(ElimiTenddf_2.ts,main="Serie lluvias Sin tendencia", ylab="Pm")
```


```{r}
library(TSstudio)
ts_heatmap(ElimiTenddf_2.ts,title = "Mapa de Calor - Lluvias")
```








